---
title: N + 1 queries and how to fix them.
categories: blog
layout: post
---

**I recently had to deal with a n + 1 query....**

Firstly let's understand why does this happen?

Data to recreate a small excercise:

Let's create a small app so we can in detail what is being produced by each active record method.

```ruby
# Create app with name `preload_demo_app`
rails new preload_demo_app
# Go to `preload_demo_app` dir
cd preload_demo_app
```
Then let's create models and add the associations we need needed.

```ruby
# Create `Event` model
rails generate model Event name:string location:string start_time:datetime
# Create `Attendee` model
rails generate model Attendee name:string
# Create `Registration` model
rails generate model Registration event:references attendee:references
```
Active Record Associations ðŸ‘‡
```ruby
# app/models/event.rb
class Event < ApplicationRecord
  has_many :registrations
  has_many :attendees, through: :registrations
end
# app/models/attendee.rb
class Attendee < ApplicationRecord
  has_many :registrations
  has_many :events, through: :registrations
end
# app/models/registration.rb
class Registration < ApplicationRecord
  belongs_to :event
  belongs_to :attendee
end
```
With this in place we can start playing with the model by opening `rails c`

`joins`:

`includes`:

`preload`:

`eager_load`:

Conclusion:

So you need a sort at database level or just with ruby is enough?