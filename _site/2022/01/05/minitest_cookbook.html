<!doctype html>
<html lang=en>
<head>
  <script>
    // Set theme immediately to prevent flash
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>
  <meta charset=utf-8>
  <meta name=author content='dom lizarraga' />
  <meta name='theme-color' content='#fff' />
  <meta name='twitter:title' content="The Minitest Cookbook" />
  <meta name=description content="" />
  <meta name=viewport content='width=device-width,minimum-scale=1'>
  <meta property='og:site_name' content="dominiclizarraga.github.io"/>
  <meta property='og:email' content="dominiclizarraga@hotmail.com"/>
  <meta property='og:type' content=blog content="domlizarrraga" />
  <meta property='twitter:account_id' content=domlizarraga_ />
  
  
  <script type='application/ld+json'>{"@context": "http://schema.org","@type": "CreativeWork","author": "dom lizarraga"}</script>
  
    <link rel=alternate type='application/rss+xml' title="dominiclizarraga.github.io - Reading" href="http://localhost:4000/reading/rss.xml" />
    <link rel=alternate type='application/atom+xml' title="dominiclizarraga.github.io - Reading" href="http://localhost:4000/reading/atom.xml" />
  
  <link rel=icon type=image/x-icon href=/css/favicon.png />
  <style>:root {
  --mono-font: San Francisco Mono, Monaco, "Consolas", "Lucida Console",
    "DejaVu Sans Mono", "Bitstream Vera Sans Mono", monospace;
  --sans-font: -apple-system, BlinkMacSystemFont, "avenir next", avenir,
    helvetica, "helvetica neue", ubuntu, roboto, noto, "segoe ui", arial,
    sans-serif;

  /* Light mode colors */
  --bg-color: #f8f5d5;
  --text-color: #111;
  --text-muted: #333;
  --text-subtle: #475569;
  --link-color: #000;
  --link-visited: #333;
  --code-bg: #fff;
  --border-color: #cfcfcf;
  --hr-color: #000;
  --input-bg: #fff;
  --input-border: rgb(133, 134, 133);
  --quote-bg: #f9f9f9;
  --header-border: #000;
  --project-link: #666;
  --project-link-hover: #000;
}

[data-theme="dark"] {
  --bg-color: #232529;
  --text-color: #d6d6d6;
  --text-muted: #b0b0b0;
  --text-subtle: #9ca3af;
  --link-color: #b68b82;
  --link-visited: #9a756d;
  --code-bg: #2d2d2d;
  --border-color: #404040;
  --hr-color: #505050;
  --input-bg: #2d2d2d;
  --input-border: #505050;
  --quote-bg: #2a2a2e;
  --header-border: #404040;
  --project-link: #9ca3af;
  --project-link-hover: #b68b82;
  --accent-color: #b68b82;
}

/* Respect system preference */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --bg-color: #232529;
    --text-color: #d6d6d6;
    --text-muted: #b0b0b0;
    --text-subtle: #9ca3af;
    --link-color: #b68b82;
    --link-visited: #9a756d;
    --code-bg: #2d2d2d;
    --border-color: #404040;
    --hr-color: #505050;
    --input-bg: #2d2d2d;
    --input-border: #505050;
    --quote-bg: #2a2a2e;
    --header-border: #404040;
    --project-link: #9ca3af;
    --project-link-hover: #b68b82;
    --accent-color: #b68b82;
  }
}

.star {
  width: 13px;
  height: 12px;
  display: inline-block;
  background-color: var(--text-color);
  -webkit-mask: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTYuMzA5IDkuMjJMMi40MDkgMTJsMS40NC00LjU2N0wwIDQuNTgzbDQuNzg4LS4wNDJMNi4zMDggMCA3LjgzIDQuNTRsNC43ODkuMDQ0LTMuODUgMi44NDlMMTAuMjA5IDEyeiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+") no-repeat center;
  mask: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTYuMzA5IDkuMjJMMi40MDkgMTJsMS40NC00LjU2N0wwIDQuNTgzbDQuNzg4LS4wNDJMNi4zMDggMCA3LjgzIDQuNTRsNC43ODkuMDQ0LTMuODUgMi44NDlMMTAuMjA5IDEyeiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+") no-repeat center;
}

[data-theme="dark"] .star {
  background-color: #b68b82;
}

body {
  color: var(--text-color);
  margin: 0px auto;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  line-height: 1.6;
  font-size: 1rem;
  font-family: var(--sans-font);
  background-color: var(--bg-color);
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Print tweaks ------------------------------------------------------------- */
.only-print {
  display: none;
}

.notitle .body p:first-child {
  margin-top: 0.25rem;
}

.body img {
  width: 100%;
  max-width: 640px;
}

/* Element styles ----------------------------------------------------------- */
sup,
sub {
  vertical-align: baseline;
  position: relative;
  top: -0.4em;
}

sub {
  top: 0.4em;
}

a {
  color: var(--link-color);
  text-decoration-skip-ink: auto;
  text-decoration: underline;
}

a:visited {
  color: var(--link-visited);
}

ol,
ul {
  margin: 1rem 0;
}

ul ul {
  margin: 0;
}

ol li ul {
  margin: 5px 10px;
}

iframe {
  border: 0;
}

small,
.small {
  font-size: 14px;
}

br {
  line-height: 1em;
}

h1 a {
  color: var(--text-color);
}

em {
  font-style: italic;
}

h1 {
  margin-bottom: 0.5rem;
  line-height: 1.25;
  font-weight: 600;
  font-size: 32px;
  letter-spacing: 0.004em;
}

h2 {
  margin-bottom: 0.5rem;
  line-height: 1.25;
  font-weight: 600;
  font-size: 1.5rem;
  letter-spacing: 0.009em;
}

h3 {
  margin-bottom: 0.5rem;
  line-height: 1.25;
  font-weight: 600;
  font-size: 1.25rem;
  letter-spacing: 0.009em;
}

h4 {
  margin-bottom: 0.5rem;
  line-height: 1.25;
  font-weight: 600;
  font-size: 1rem;
}

h5 {
  margin-bottom: 0.5rem;
  line-height: 1.25;
  font-weight: 600;
  font-size: 0.875rem;
}

p {
  margin: 1rem 0;
}

blockquote {
  font-size: 16px;
  line-height: 25px;
}

td {
  vertical-align: top;
}

hr {
  background: var(--hr-color);
  height: 1px;
  border: 0;
}

summary {
  cursor: pointer;
}

.body table {
  border-collapse: collapse;
  border-spacing: 0;
  width: 100%;
}

.body th {
  text-align: left;
}

.body td,
.body th {
  padding: 0.5rem;
}

.body td {
  border: 1px solid var(--border-color);
}

.limiter {
  max-width: 640px;
  padding-left: 20px;
  padding-right: 20px;
  margin-left: auto;
  margin-right: auto;
}

/* Padding --------------------------------------- */
.pad2y {
  padding-top: 20px;
  padding-bottom: 20px;
}

span.image-credit {
  float: right;
  margin: 0 0 10px 10px;
  font-size: 12px;
}

span.image-credit:before {
  content: "↑";
  margin-right: 5px;
}

figcaption {
  font-size: 11px;
  text-align: center;
  font-size: 0.8rem;
  margin-top: -1.2rem;
}

div.post blockquote p {
  margin: 0;
}

/** Writing ----------------------------------------------------------------- */
.writing,
.books {
  display: grid;
  grid-column-gap: 5px;
  grid-row-gap: 5px;
}

.writing {
  grid-template-columns: 1fr min-content;
}

.books {
  grid-template-columns: 1fr 0.75fr min-content 70px;
}

.writing a,
.books a {
  font-weight: 500;
  letter-spacing: -0.015em;
}

.writing > div,
.books > div {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.writing time,
.books time {
  padding-right: 0.25em;
  color: var(--text-muted);
  font-variant-numeric: tabular-nums;
  letter-spacing: -0.012em;
  white-space: pre;
}

.project-box {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 30px;
}

.project-box a.project {
  text-decoration: none;
  color: var(--project-link);
}
.project-box a.project:hover {
  color: var(--project-link-hover);
}
.project-box a.project img {
  display: block;
  margin-bottom: 10px;
  border-radius: 0.375rem;
  height: 160px;
  object-fit: cover;
}

/** Responsive -------------------------------------------------------------- */

/* Screen width:  0px -------- 480px -------- 640px -------- 1024px -------- ∞ */
/* max-width: 480px:  |←――――――| */
/* max-width: 640px:  |←―――――――――――――| */
/* min-width: 640px:                    |――――――――――――――――――――――――――――→| */
/* max-width: 1024px: |←――――――――――――――――――――――――――| */

@media screen and (max-width: 480px) {
  .project-box {
    grid-template-columns: repeat(1, 1fr);
  }
}

@media screen and (max-width: 640px) {
  .limiter {
    width: auto;
  }
  .project-box {
    grid-template-columns: repeat(2, 1fr);
  }
  .writing,
  .books {
    grid-template-columns: 1fr;
    grid-row-gap: 0px;
  }

  .writing div,
  .books div {
    white-space: normal;
  }

  .writing time,
  .books div:nth-child(4n) {
    padding-bottom: 20px;
  }
}

@media screen and (min-width: 640px) {
  .nu a {
    text-decoration: none;
  }

  .nu a:hover {
    text-decoration: underline;
  }
}

@media screen and (max-width: 1024px) {
  .header-wrap {
    border-bottom: 1px solid var(--header-border);
    padding-bottom: 10px;
  }

  .sigil {
    display: none;
  }
  /* this css if for containing search result in mobile */
  #lunrsearchresults {
    width: 350px !important;
    overflow-x: hidden;
  }

  .about-image{
    margin-top: 5px;
  }

  .project-box {
    margin-top: 5px;
    margin-bottom: 20px;
  }
}

@media screen and (min-width: 1025px) {
  .header {
    position: absolute;
    /* top: 40px; */
    right: 50%;
    margin-right: 340px !important;
    letter-spacing: -0.009em;
  }
  .content h1:first-child {
    margin-top: 0;
  }
}

@media print {
  .no-print {
    display: none;
  }
  .only-print {
    display: block;
  }
  body {
    margin: 0;
  }
  .limiter {
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
  }
}

/** Code highlighting ------------------------------------------------------- */
p code,
pre code,
li code,
g.highlight,
.code {
  font-family: var(--mono-font);
}

p code {
  font-size: 90%;
}

pre code {
  font-size: 0.8rem;
  line-height: 1.5;
}

.highlight,
blockquote {
  overflow-x: auto;
  padding: 10px 20px;
  margin: 0;
  background: var(--code-bg);
  border-radius: 10px;
}

blockquote {
  font-style: italic;
}

blockquote p:first-child {
  margin-top: 0;
}

blockquote p:last-child {
  margin-bottom: 0;
}

/* pygments theme. does not support generics. .highlight class omitted */
.highlight {
  margin: 10px 0;
}

.highlight .hll {
  background-color: #ffffcc;
}

.c, /* Comment */
.cm, /* Comment.Multiline */
.cp, /* Comment.Preproc */
.cs, /* Comment.Special */
.c1 {
  color: #999988;
} /* Comment.Single */

.o, /* Operator */
.ow, /* Operator.Word */
.ge {
  color: #000000;
} /* Generic.Emph */

.kc, /* Keyword.Constant */
.kd, /* Keyword.Declaration */
.kn, /* Keyword.Namespace */
.kp, /* Keyword.Pseudo */
.kr, /* Keyword.Reserved */
.kt {
  color: #445588;
} /* Keyword.Type */

.err {
  color: #a61717;
} /* Error */

.m {
  color: #007f7f;
} /* Literal.Number */
.s {
  color: #d01040;
} /* Literal.String */

.na, /* Name.Attribute */
.nb, /* Name.Builtin */
.nc, /* Name.Class */
.no, /* Name.Constant */
.nd, /* Name.Decorator */
.ni, /* Name.Entity */
.ne, /* Name.Exception */
.nf, /* Name.Function */
.nn, /* Name.Namespace */
.nt, /* Name.Tag */
.nl {
  color: #990000;
} /* Name.Label */

.k, /* Keyword */
.nv {
  color: #008080;
} /* Name.Variable */

.mf, /* Literal.Number.Float */
.mh, /* Literal.Number.Hex */
.mi, /* Literal.Number.Integer */
.mo {
  color: #009999;
} /* Literal.Number.Oct */

.sb, /* Literal.String.Backtick */
.sc, /* Literal.String.Char */
.sd, /* Literal.String.Doc */
.s2, /* Literal.String.Double */
.se, /* Literal.String.Escape */
.sh, /* Literal.String.Heredoc */
.s1, /* Literal.String.Single */
.si, /* Literal.String.Interpol */
.ss, /* Literal.String.Symbol */
.bp, /* Name.Builtin.Pseudo */
.sx {
  color: #d01040;
} /* Literal.String.Other */

.sr, /* Literal.String.Regex */
.vc, /* Name.Variable.Class */
.vg, /* Name.Variable.Global */
.vi, /* Name.Variable.Instance */
.il {
  color: #009999;
} /* Literal.Number.Integer.Long */

/** Code for buy me a coffe mobile version ------------------------------------------------------- */

.mobile-only-button {
  margin-top: 30px;
  display: none;
}

@media screen and (max-width: 480px) {
  .mobile-only-button {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 50px;
  }
  
  /* Style for the generated iframe */
  .mobile-only-button iframe {
    margin: 0 auto;
  }
}

/** Code for styling reading time ------------------------------------------------------- */

.reading-time {
  color: var(--text-subtle);
  text-align: right;
  font-style: italic;
}

/** Code for footer + RSS svg ------------------------------------------------------- */

.personal-elements-container, a[rel="nofollow"], .rss-text {
  color: var(--text-subtle);
  font-style: italic;
  display: flex;
  /* align-items: center; */
  flex-direction: column;
  gap: 10px;
}

.rss-link {
  display: flex;
  align-items: flex-end;
}

/** Code for search bar ------------------------------------------------------- */

.search-bar-desktop {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-end;
  padding: 10px 20px;
  gap: 10px;
}

.search-wrapper {
  display: flex;
  align-items: center;
}

.search-form {
  margin: 0;
}

.search-input {
  border: 1px solid var(--input-border);
  padding: 8px 12px;
  background-color: var(--input-bg);
  color: var(--text-color);
  width: 200px;
  border-radius: 4px;
  font-size: 0.875rem;
  transition: border-color 0.2s, width 0.2s, background-color 0.3s;
}

.search-input:focus {
  border-color: var(--text-muted);
  outline: none;
  width: 280px;
}

/** Code for search results ------------------------------------------------------- */

.search-results {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 500px;
  max-width: 90vw;
  max-height: 70vh;
  overflow-y: auto;
  background: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  display: none;
}

.search-results.has-results {
  display: block;
}

.search-results-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-color);
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--text-muted);
}

.search-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-muted);
  padding: 0;
  line-height: 1;
}

.search-close:hover {
  color: var(--text-color);
}

.search-results-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.search-result-item {
  border-bottom: 1px solid var(--border-color);
}

.search-result-item:last-child {
  border-bottom: none;
}

.search-result-item a {
  display: block;
  padding: 12px 16px;
  text-decoration: none;
  color: var(--text-color);
  transition: background-color 0.15s;
}

.search-result-item a:hover {
  background-color: var(--quote-bg);
}

.search-result-title {
  display: block;
  font-weight: 500;
  margin-bottom: 4px;
  color: var(--link-color);
}

.search-result-body {
  display: block;
  font-size: 0.8rem;
  color: var(--text-muted);
  line-height: 1.4;
}

.search-result-item.no-results {
  padding: 16px;
  color: var(--text-muted);
  text-align: center;
}

.search-loading {
  padding: 16px;
  color: var(--text-muted);
  text-align: center;
  font-style: italic;
}

.search-error {
  padding: 16px;
  color: #d00;
  text-align: center;
}

@media screen and (max-width: 640px) {
  .search-results {
    left: 50%;
    transform: translateX(-50%);
    width: 95vw;
  }

  .search-input {
    width: 140px;
  }

  .search-input:focus {
    width: 160px;
  }
}

strong {
  margin-bottom: 1rem;
  display: block;
}

/** CSS style for authors quotes in 99 bottles book notes ------------------------------------------------------- */

.quote-box {
  margin: 20px auto;
  padding: 8px 10px;
  max-width: 600px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  background-color: var(--quote-bg);
  text-align: center;
  font-size: 14px;
}

/* Theme toggle button */
.theme-toggle {
  background: none;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  cursor: pointer;
  padding: 6px 10px;
  font-size: 0.7rem;
  font-family: var(--mono-font);
  color: var(--text-muted);
  transition: all 0.2s;
  text-transform: lowercase;
  letter-spacing: 0.02em;
}

.theme-toggle:hover {
  border-color: var(--text-color);
  color: var(--text-color);
}

.theme-toggle:active {
  transform: scale(0.95);
}

/* Back to top button */
.back-to-top {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 44px;
  height: 44px;
  background: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s, transform 0.2s;
  z-index: 100;
  color: var(--text-muted);
}

.back-to-top.visible {
  opacity: 1;
  visibility: visible;
}

.back-to-top:hover {
  border-color: var(--text-color);
  color: var(--text-color);
  transform: translateY(-2px);
}

.back-to-top:active {
  transform: translateY(0);
}

@media screen and (max-width: 640px) {
  .back-to-top {
    bottom: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
  }
}</style>
  <title>The Minitest Cookbook - dominiclizarraga.github.io</title>
  
  <link rel="canonical" href="http://localhost:4000/2022/01/05/minitest_cookbook.html">
  <!-- <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="domlizarrraga" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script> -->
</head>
<body>
  <div class="limiter search-bar-desktop">
    <div class="search-wrapper">
  <form class="search-form" onSubmit="return initSearchAndQuery(document.getElementById('lunrsearch').value);">
    <input
      type="text"
      class="search-input"
      id="lunrsearch"
      name="q"
      maxlength="120"
      placeholder="Search"
    />
  </form>
</div>

<div id="lunrsearchresults" class="search-results"></div>

<script>
var searchIndex = null;
var searchDocuments = null;
var lunrLoaded = false;

function loadLunr(callback) {
  if (lunrLoaded) {
    callback();
    return;
  }
  var script = document.createElement('script');
  script.src = '/js/lunr.js';
  script.onload = function() {
    lunrLoaded = true;
    callback();
  };
  document.head.appendChild(script);
}

function loadSearchIndex(callback) {
  if (searchDocuments) {
    callback();
    return;
  }
  fetch('/search-index.json')
    .then(function(response) { return response.json(); })
    .then(function(data) {
      searchDocuments = data;
      callback();
    })
    .catch(function(err) {
      console.error('Failed to load search index:', err);
      document.getElementById('lunrsearchresults').innerHTML = '<p class="search-error">Search unavailable</p>';
    });
}

function buildIndex() {
  if (searchIndex) return;
  searchIndex = lunr(function () {
    this.ref('id');
    this.field('title', { boost: 10 });
    this.field('body');
    var self = this;
    searchDocuments.forEach(function (doc) {
      self.add(doc);
    });
  });
}

function performSearch(term) {
  var resultsEl = document.getElementById('lunrsearchresults');

  if (!term) {
    resultsEl.innerHTML = '';
    resultsEl.classList.remove('has-results');
    return false;
  }

  var results = searchIndex.search(term);

  var html = '<div class="search-results-header">Results for "' + term + '"';
  html += '<button class="search-close" onclick="closeSearch()">&times;</button></div>';
  html += '<ul class="search-results-list">';

  if (results.length > 0) {
    for (var i = 0; i < results.length; i++) {
      var ref = results[i]['ref'];
      var doc = searchDocuments.find(function(d) { return d.id == ref; });
      if (doc) {
        var body = doc.body.substring(0, 120) + '...';
        html += '<li class="search-result-item">';
        html += '<a href="' + doc.url + '">';
        html += '<span class="search-result-title">' + doc.title + '</span>';
        html += '<span class="search-result-body">' + body + '</span>';
        html += '</a></li>';
      }
    }
  } else {
    html += '<li class="search-result-item no-results">No results found</li>';
  }

  html += '</ul>';
  resultsEl.innerHTML = html;
  resultsEl.classList.add('has-results');
  return false;
}

function closeSearch() {
  var resultsEl = document.getElementById('lunrsearchresults');
  resultsEl.innerHTML = '';
  resultsEl.classList.remove('has-results');
  document.getElementById('lunrsearch').value = '';
}

function initSearchAndQuery(term) {
  var resultsEl = document.getElementById('lunrsearchresults');
  resultsEl.innerHTML = '<p class="search-loading">Searching...</p>';
  resultsEl.classList.add('has-results');

  loadLunr(function() {
    loadSearchIndex(function() {
      buildIndex();
      performSearch(term);
    });
  });
  return false;
}
</script>

    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode" title="Toggle dark mode">
      <span class="theme-icon">dark</span>
    </button>
  </div>
  <div class='' style='position:relative'>
    
    <div class='only-print'>
      <h2>dom lizarraga</h2>
      <div style='margin-top:0;'>dominiclizarraga@hotmail.com</div>
    </div>
    <nav class='header-wrap'>
      <div class='header nu limiter no-print'>
        <h1 style='line-height:1.6;font-size:1rem;margin:0 0 0.25em 0;'>dom lizarraga</h1>
        <ul style='list-style:none;padding:0;margin:0;'>
          <li style='margin:0.5rem 0;'><a href='/'>Notes</a></li>
          <li style='margin:0.5rem 0;'><a href='/reading/'>Reading</a>⇠</li>
          <li style='margin:0.5rem 0;'><a href='/projects/'>Projects</a></li>
          <li style='margin:0.5rem 0;'><a href='/computer-science/'>Computer <br>Science</a></li>
          <li style='margin:0.5rem 0;'><a href='/pood/'>Object-Oriented <br>Design</a></li>          <li style='margin:0.5rem 0;'><a href='/confs/'>Confs</a></li>
          <li style='margin:0.5rem 0;'><a href='/about/'>About</a></li>
        </ul>
      </div>
    </nav>
    <div class='limiter content '>
      <nav class="post-nav">
  <a href="javascript:history.back()" class="no-underline back-link" aria-label="Go back one page">
    <i aria-hidden="true">←</i>
    <span class="underline">Back one page</span>
  </a>
</nav>


<div itemscope itemtype="http://schema.org/Review">

<h1 style='font-size: 30px;'>
I read The Minitest Cookbook by Chris Kottom
on <span itemprop="datePublished" datetime="2022-01-05">January 5, 2022</span>
</h1>


<h3 itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating">Review
  <meta itemprop="worstRating" content="1">
  <meta itemprop="ratingValue" content="5">
  <meta itemprop="bestRating" content="5">
  <div
    class='star'
    class='value-title'
    title='5'
    style='margin-left:10px;display:inline-block;background-size:15px 14px;height:14px;width: 75px'></div>
</h3>

<div itemprop="description" class='body'><p>Today though, the separation between development and testing has largely disappeared - at least in the universe that most Ruby and Rails programmers occupy.</p>

<p>In many if not most cases now, the one writing the code is also responsible for producing automated tests that cover the work
done. And while you’re probably sick of hearing it, this is a good thing for all kinds of reasons. Why?</p>

<p>• Tests demonstrate that your code actually works.
• The pattern of thinking needed to write tests for code is very close to
that needed to design it.
• Testing and developing in parallel tends to surface more bugs early in the development process when fixing them is cheap and easy.
• Well-tested code tends to be better designed with reduced coupling and greater cohesion.
• A good test suite acts as a detailed specification.
• Writing tests during development increases programmer engagement and efficiency.
• A test suite with good coverage aids in maintenance, refactoring, and upgrades with reduced risk of breakage and regression.
• It’s faster to write code with tests than without.
• Having automated tests reduces or removes the need for manual testing</p>

<p>Best tests will have a few important characteristics in common:
• Clarity: The name of each test suggests what it’s about at a glance.
• Purpose: The intent and meaning of the test is obvious and unambiguous from the testing logic.
• Eloquence: The test logic is expressed through fluent use of the language and the testing framework.
• Readability: Tests are written and formatted in a way that promotes rapid discovery and comprehension.
• Efficiency: All other things being equal, automated tests should use the minimum possible system resources</p>

<p>Unlike a lot of books on testing, this one won’t dwell on the mechanics of test-driven development. TDD has become so prevalent and popular among the Ruby and Rails development community that you’d be hard pressed to find a book on testing or development that doesn’t take it as a starting point for everything taught. But TDD is primarily about development and only incidentally about testing, and it often treats the tests that fall out of it as a by-product rather than as first-class citizens of your project. That tends to result in test suites that are neglected after they’ve served the purpose of driving out features.</p>

<p>• Fact: The entire framework weighs in at less than 1600 lines of code. RSpec is almost 8 times as large. With a code base that size, the source practically becomes its own documentation.
• Fact: Minitest has been singled out as a very readable project because it’s written in plain Ruby that developers of all experience
levels can dig into and understand.
• Fact: The project has remained small and simple because of conscious decisions to keep it that way in spite of frequent requests
for expanded features.
• Fact: The source code showcases Ruby’s power and elegance with great uses of closures, metaprogramming, concurrent programming, and others.
• Fact: Since the Minitest framework also happens to be tested with Minitest, it includes some exceptional practical examples illustrating good testing technique</p>

<p>To really get comfortable with Minitest’s internals, there are four basic abstractions that you’ll need to understand: plugins, reporters, runnables and the Minitest runner.</p>

<p>Plugins</p>

<p>In Minitest, plugins are modules that extend or modify the behavior of Minitest. They can be used to add new features, customize the test runner, or modify the output of test results. Examples of plugins in Minitest include pride (a colorful test runner), parallel (for parallel test execution), and focus (to run specific tests or test suites).</p>

<p>Minitest plugins are usually packaged as RubyGems which implement a simple framework-defined contract that allows them to be loaded an initialized by the framework. Specifically speaking, every plugin includes a loader file that follows a standard naming convention - ex: minitest/ foo_plugin.rb where foo is the name of the plugin.</p>

<p>minitest-rails is a plugin for Minitest that adds some additional features for working with Ruby on Rails applications. It provides some additional test generators that can create test files for your Rails application’s models, controllers, views, and helpers. It also includes support for testing Rails-specific features like routes and controllers.</p>

<p>In addition to the generators, minitest-rails also provides a Rails-specific test runner that sets up the Rails environment before running the tests. This can be helpful if your tests need to access Rails configuration or other Rails-specific features.</p>

<p>Overall, minitest-rails is a helpful plugin for anyone working with Ruby on Rails applications and using Minitest as their testing framework.</p>

<p>Another example: the minitest/pride plugin adds colorful output to your test results in the terminal.</p>

<p>Reporters</p>

<p>A test suite is a map for directing development effort to the parts of your project that need it. From this perspective, the results reported by your test suite act as its user interface and indicate the state of your code base.</p>

<p>Each test Minitest runs passes a result to a Reporter object which is responsible for acting on it. Depending on the Reporter, it might:
• Display information to the console.
• Store the result for later processing.
• Increment counters or compile statistics.
• Send the result to another system - ex: a CI, a database, etc.</p>

<p>As an abstraction, a Reporter is just an object that implements four methods that allow it to accept and operate on test results:
• #start - called before the first test is run
• #record - accept and process a single test result
• #report - deliver a detailed report after the test run
• #passed? - indicate passed/failed/errored/skipped tests</p>

<div><img src="/../graphics/projects/cook_book_1.png" alt="beginning_rails" style="width:500px;" /></div>

<p>In Minitest, reporters are used to generate output of the test results. They provide various types of outputs such as progress bar, detailed documentation, and colorized output.</p>

<p>Runnables</p>

<p>In Minitest, runners are classes that run a set of tests.</p>

<p>Assert-style tests and Spec-style tests are two different styles of writing tests in Minitest.</p>

<p>Assert-style tests are based on assertions that verify the expected result of a test. They are usually written using methods such as assert, assert_equal, assert_match, etc. The focus is on verifying specific outcomes and behavior of the code being tested.</p>

<p>Spec-style tests are based on specifying the expected behavior of a system or component. They are usually written using describe and it blocks that describe the behavior of the code being tested. The focus is on describing the behavior and intent of the code, rather than just verifying specific outcomes.</p>

<p>Assert-style tests are based on the idea of making assertions about the state of the system under test. These tests usually follow the “Arrange-Act-Assert” pattern, where the test sets up the system’s initial state, performs some action, and then makes one or more assertions about the system’s final state. (This uses instance methods starting with the string “test_”).</p>

<p>Spec-style tests, on the other hand, are based on the idea of describing the behavior of the system under test using a domain-specific language (DSL). In these tests, the focus is on describing what the system should do rather than how it should do it. Spec-style tests often use “describe” and “it” blocks to structure the test code.</p>

<p>Both styles of testing have their pros and cons, and the choice of which one to use often comes down to personal preference and the requirements of the project. Some developers prefer the clarity and simplicity of Assert-style tests, while others find the expressiveness and readability of Spec-style tests to be more appealing. Ultimately, the most important thing is to choose a style that works for you and your team and allows you to write effective, maintainable tests.</p>

<p>The Minitest Runner</p>

<p>The Minitest Runner is the component responsible for running Minitest test suites. It loads the test files, executes the tests, and reports the results. By default, Minitest uses the Minitest::Runnable and Minitest::Test classes to define and run tests, respectively. However, the runner can be customized to use other classes or to change the way the tests are run. The runner is a key part of Minitest’s flexibility and extensibility.</p>

<p>The runner and Runnables fit together like the layers of an onion where each layer represents a Ruby block or method. The inner layers represent the Runnables where the tests are actually executed, and the outer layers represent the runner - the code that gives the onion its shape.</p>

<p>Minitest.run
Next, Minitest sets up the environment for the test run along with all the necessary supporting objects. All the framework’s major responsibilities are handled right here as it:
• Parses the command line arguments.
• Loads and initializes all detected Minitest plugins.
• Instantiates and runs the reporters.
• Runs tests by passing control on to the next layer.
• Ensures that parallel worker threads are shut down gracefully.</p>

<hr />
<p>Basic Recipes</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Problem</span><span class="p">:</span>
<span class="k">class</span> <span class="nc">FizzBuzz</span>
	<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span>
			<span class="s2">"FizzBuzz"</span>
		<span class="k">elsif</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span>
			<span class="s2">"Buzz"</span>
		<span class="k">elsif</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span>
			<span class="s2">"Fizz"</span>
		<span class="k">else</span>
		<span class="n">number</span><span class="p">.</span><span class="nf">to_s</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Takeaways
You need four things to develop a Ruby project with Minitest:
• Install Minitest as a project dependency with Bundler.
• Create a test directory at test/ .
• Create a test helper to include all global configuration and customization at test/test_helper.rb .
• Create a new Rakefile or update the existing one with a Rake::TestTask configured to suit your needs (by convention to run tests you use the command <code class="language-plaintext highlighter-rouge">rake</code>)</p>

<hr />
<p>Writing Tests</p>

<p>All the tests that we write follow the same basic four-phase structure.
	1. Setup the inputs and data objects prior to running the test.
	2. Exercise the logic under test.
	3. Verify that the tested code produces the expected results.
	4. Teardown or reset application state before running the next test.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>
<span class="nb">require</span> <span class="s1">'fizz_buzz'</span>

<span class="k">class</span> <span class="nc">FizzBuzzTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
	<span class="k">def</span> <span class="nf">setup</span> 
		<span class="vi">@fb</span> <span class="o">=</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span>
	<span class="k">end</span>
	<span class="k">def</span> <span class="nf">test_converts_multiples_of_fifteen_to_fizzbuzz</span>
		<span class="c1"># fb = FizzBuzz.new</span>
		<span class="n">assert_equal</span> <span class="s1">'FizzBuzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'FizzBuzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'FizzBuzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
		<span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">90</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
			<span class="n">assert_equal</span> <span class="s1">'FizzBuzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">end</span>
	<span class="k">def</span> <span class="nf">test_converts_multiples_of_five_to_buzz</span>
		<span class="c1"># fb = FizzBuzz.new</span>
		<span class="n">assert_equal</span> <span class="s1">'Buzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'Buzz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'Buzz'</span><span class="p">,</span> <span class="mi">2</span><span class="n">fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
	<span class="k">end</span>
	<span class="k">def</span> <span class="nf">test_converts_multiples_of_three_to_fizz</span>
		<span class="c1"># fb = FizzBuzz.new</span>
		<span class="n">assert_equal</span> <span class="s1">'Fizz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'Fizz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'Fizz'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">48</span><span class="p">)</span>
		<span class="c1"># another example could have been assert 'Fizz' == fb.convert(3)</span>
	<span class="k">end</span>
	<span class="k">def</span> <span class="nf">test_returns_same_number_for_other_numbers</span>
		<span class="n">assert_equal</span> <span class="s1">'1'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'101'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
		<span class="n">assert_equal</span> <span class="s1">'2014'</span><span class="p">,</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">2014</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<div><img src="/../graphics/projects/cook_book_2.png" alt="beginning_rails" style="width:500px;" /></div>

<div><img src="/../graphics/projects/cook_book_3.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Another example of syntaxis:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticleTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
	<span class="nb">test</span> <span class="s2">"should not save article without title"</span> <span class="k">do</span>
		<span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
		<span class="n">assert_not</span> <span class="n">article</span><span class="p">.</span><span class="nf">save</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<div><img src="/../graphics/projects/cook_book_4.png" alt="beginning_rails" style="width:500px;" /></div>

<p>That’s why many developers follow a strict one assertion per test policy - so that each assertion has exactly one chance to succeed or fail. It’s true that your tests will be better and more maintainable when each test verifies a single behavior of the system, but writing a single test for each of the assertions above seems like overkill to me since they’re all testing the same general behavior.</p>

<p>setup runs before each test.
teardown runs after each test.</p>

<p>It’s better to favor readability over DRY-ness when writing tests.</p>

<p>Usage of skip</p>

<p>Skip can be useful in situations where you want to write a test that specs out some future work that you’re not
quite ready to code just yet. For example, FizzBuzzTest doesn’t currently check to see what happens when we pass it an  unexpected input.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">test_raises_argument_error_for_bad_argument</span>
	<span class="n">skip</span> <span class="s1">'not yet implemented'</span>
	<span class="n">assert_raises</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
	<span class="n">assert_raises</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
	<span class="n">assert_raises</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">}</span>
	<span class="n">assert_raises</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span> <span class="p">}</span>
	<span class="n">assert_raises</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

</code></pre></div></div>

<p>Takeaways
	• Assert-style test cases are classes that inherit from Minitest::Test.
	• Public instance methods of those classes whose names begin with test_ are treated as tests by the runner.
	• Minitest provides a small set of assertions out of the box, and of those, about half are used frequently.
	• Override the setup and teardown methods to include code that should be executed before or, respectively, after each test is
	executed.
	• If you have to choose between readability and DRY-ness in your tests, you should almost always choose readability.</p>

<p>Writing Specs</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FizzBuzzIterator</span>
	<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="vi">@counter</span> <span class="o">=</span> <span class="n">start</span>
		<span class="vi">@fb</span> <span class="o">=</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span>
	<span class="k">end</span>
	<span class="k">def</span> <span class="nf">next</span>
		<span class="n">input</span> <span class="o">=</span> <span class="vi">@counter</span>
		<span class="vi">@counter</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="vi">@fb</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>
<span class="nb">require</span> <span class="s1">'fizz_buzz_iterator'</span>

<span class="n">describe</span> <span class="no">FizzBuzzIterator</span> <span class="k">do</span>
	<span class="n">it</span> <span class="s1">'outputs sequential FizzBuzz values starting from 1 when initialized without a starting value'</span> <span class="k">do</span>
		<span class="n">iterator</span> <span class="o">=</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span>
		
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'1'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'2'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'4'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Buzz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
	<span class="k">end</span>
	<span class="n">it</span> <span class="s1">'outputs sequential FizzBuzz values starting from the starting value when initialized with a starting value'</span> <span class="k">do</span>
		<span class="n">iterator</span> <span class="o">=</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
		
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Buzz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'11'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'13'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'14'</span>
		<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'FizzBuzz'</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Other alternatives</span>

<span class="n">expect</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
<span class="n">value</span><span class="p">(</span><span class="n">iteratory</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'11'</span>
<span class="n">_</span><span class="p">(</span><span class="n">iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Buzz'</span>

</code></pre></div></div>
<p>Assertion vs Expectation</p>

<div><img src="/../graphics/projects/cook_book_5.png" alt="beginning_rails" style="width:500px;" /></div>

<div><img src="/../graphics/projects/cook_book_6.png" alt="beginning_rails" style="width:500px;" /></div>

<div><img src="/../graphics/projects/cook_book_7.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Like most powerful tools, this one can be abused. As a general rule, try to limit describe block nesting to at most two or three layers deep. More than that and the specs hard to follow and less readable for future developers (including future you).</p>

<p>Before and After for Spec-Style</p>

<p>before blocks for all enclosing scopes will be called before the test logic in order from outermost to innermost.</p>

<p>after blocks for all enclosing scopes will be called after the test logic in order from innermost to outermost.</p>

<p>In practical terms, this lets us define blocks with increasingly specific setup and teardown logic that cascade or override previous operations</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>
<span class="nb">require</span> <span class="s1">'fizz_buzz_iterator'</span>

<span class="n">describe</span> <span class="no">FizzBuzzIterator</span> <span class="k">do</span>
	<span class="n">before</span> <span class="k">do</span>
		<span class="vi">@iterator</span> <span class="o">=</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span>
	<span class="k">end</span>
	
	<span class="n">it</span> <span class="s1">'outputs sequential FizzBuzz values starting from 1'</span> <span class="k">do</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'1'</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'2'</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'4'</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Buzz'</span>
		<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
	<span class="k">end</span>
	
	<span class="n">describe</span> <span class="s1">'when initialized with a starting value'</span> <span class="k">do</span>
		<span class="n">before</span> <span class="k">do</span>
			<span class="vi">@iterator</span> <span class="o">=</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
		<span class="k">end</span>
		<span class="n">it</span> <span class="s1">'outputs sequential FizzBuzz values starting from the starting value'</span> <span class="k">do</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Buzz'</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'11'</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'Fizz'</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'13'</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'14'</span>
			<span class="n">expect</span><span class="p">(</span><span class="vi">@iterator</span><span class="p">.</span><span class="nf">next</span><span class="p">).</span><span class="nf">must_equal</span> <span class="s1">'FizzBuzz'</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The let function provides an alternate and some would say more elegant way of setting up testing state with a more declarative syntax.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">describe</span> <span class="no">FizzBuzzIterator</span> <span class="k">do</span>
	<span class="n">let</span><span class="p">(</span><span class="ss">:iterator</span><span class="p">)</span> <span class="p">{</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>
	<span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">FizzBuzzIterator</span> <span class="k">do</span>
	<span class="n">let</span><span class="p">(</span><span class="ss">:iterator</span><span class="p">)</span> <span class="p">{</span> <span class="no">FizzBuzzIterator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">}</span>
	<span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Each call to let dynamically defines a new method with the specified name that executes the block argument upon the first invocation and caches the result for later access - in other words, a lazy initializer.</p>

<p>Takeaways</p>

<p>• Create a new test case in Minitest::Spec using a top-level describe block with a String or Class argument.</p>

<p>• Define a test using an it block with a descriptive String passed as a parameter.</p>

<p>• Make assertions on the values of expressions by wrapping them in a Minitest::Expectation object using expect or one of its aliases.</p>

<p>• Use nested describe blocks to define scopes within a test case as a way of grouping related tests.</p>

<p>• Implement before and after blocks for shared setup and teardown logic specific to a block context.</p>

<h2 id="-create-named-lazy-initializers-using-let-blocks">• Create named lazy initializers using let blocks.</h2>

<p>Configure Pre-Test State</p>

<p>As explained back in Writing Tests, each test run under Minitest follows a common progression of steps: Setup, Exercise, Verify, and Teardown. Of these, Setup usually accounts for more lines of code and can be the toughest for new developers to understand. There are several options for setting the state, and knowing which one is the best fit requires familiarity with all of them.</p>

<p>Method 1: Set up the same state before each test.</p>

<div><img src="/../graphics/projects/cook_book_8.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Method 2: Configure different state before each test.</p>

<div><img src="/../graphics/projects/cook_book_9.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Method 3: Using a memoized helper method.</p>

<div><img src="/../graphics/projects/cook_book_10.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Method 4: Create data objects within the test.</p>

<div><img src="/../graphics/projects/cook_book_11.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Collections</p>

<p>Enumerable types where order doesn’t matter like Hash and Set count two instances as being equal if they contain the same elements regardless of the order in which the elements were added or passed during initialization.</p>

<div><img src="/../graphics/projects/cook_book_12.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Relations (active record)</p>

<p>Just as with Arrays though, order matters, so you’ll need to ensure that both the actual and the expected values are sorted the same way when performing comparisons.</p>

<div><img src="/../graphics/projects/cook_book_13.png" alt="beginning_rails" style="width:500px;" /></div>

<p>ActiveRecord::Relation objects compare mostly like Arrays except when compared with others of the same type, and then according to the SQL representation.</p>

<div><img src="/../graphics/projects/cook_book_14.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Dates and Times</p>

<div><img src="/../graphics/projects/cook_book_16.png" alt="beginning_rails" style="width:500px;" /></div>

<p>Intermediate Recipes</p>

<p>Mocks:  mocks test the behavior of an object toward the objects to which it sends messages.</p>

<p>Use mocks sparingly and only after careful consideration. The more collaborators you mock, the greater your risk of false positives.</p>

<p>• Only mock what you own. If you don’t own it, the API could change, and you’d never detect it in your tests.
• Only mock immediate collaborators and avoid deep mocking (mocks returning mocks returning mocks).
• Ideally, only use mocks to solve specific difficult problems like:
◦ Connecting to unreliable or uncontrollable external resources
◦ Real object performance is prohibitively slow
◦ Expensive setup and/or configuration
◦ Avoiding other undesirable side effects</p>

<p>Stubs
Stubs provide the context needed to fully exercise an object through a given test scenario</p>

<p>• Use stubs wherever and whenever they’re needed, but recognize that needing too many is probably a code smell.
• Don’t use stubs where they’re not needed, and apply them as narrowly as possible where you do use them. (See Mocha’s stub_everything and any_instance.stub as prime examples of mocking framework features promoting bad coding practices.)
• Never ever, ever stub the object under test. More often than not, you’ll end up testing the stub and not the object itself.</p>

<p>Fake Objects</p>

<p>A fake is an alternate version of a given class intended for testing only. It exposes an interface resembling that of the real thing it replaces but with an implementation that’s either simplified or hollowed out which allows
them to:
• Capture and verify interactions between the object under test and the fake object (like a mock).
• Maintain consistent interactions between the object under test and the fake object (like a stub).
• Avoid resource-intensive or otherwise undesirable processing (like both mocks and stubs).</p>

<p>We could have gotten the same result using mocking or stubbing, but it might have taken many more lines of setup code. A fake can be a great fit when dealing with complex APIs since it comes ready-made and pre-programmed with the behavior we want and need for running our tests.</p>

<p>Testing Mixin Behavior</p>

<p>Testing something that can’t be instantiated on its own confuses many developers.</p>

<p>two types of mixins:</p>

<p>Those that are coupled with the classes that include them, and those that aren’t (non-coupled modules)</p>

<p>Takeaways</p>

<p>• Use Object#extend to patch a mixin’s method into a simple Object for easy testing.
• Try mixing into a Ruby Struct in cases where you need the including class to have some specific attributes or behavior of its own.</p>

<p>Sharing Code Between Tests</p>

<p>One point that should be clear to you by now is this: a self-contained test is a readable test. Minitest provides a nice, narrow vocabulary for writing tests, and when we stick to that vocabulary, life becomes better for the developers that follow.</p>

<p>When it comes to organizing tests:
• Extracting code into a new helper methods
• Extracting helper methods into a new module
• Extracting tests into a new module</p>

<p>Extracting helper methods by:
• Using descriptive names for helper methods and variable arguments
• Updating the extracted code to ensure that it’s still comprehensible, even outside the previous context</p>

<p>Takeaways</p>

<p>• Code shared within a single test case can be extracted to a private helper method in the same class.
• Code shared across multiple test cases can be extracted to a module that may be included in all.
	◦ Sharing tests between test cases is a special case of this</p>

<p>Managing Test Data</p>

<p>• Whenever persistence isn’t important to your test, use Object.new to create a new instance.
• Rails fixtures have a lot going for them including great performance and a reliable set of known models for your tests.
• Use both functional and memorable names for your fixtures.
• Configure your fixtures carefully, and try to cover at least:
◦ One minimal valid configuration
◦ One or two realistic models
◦ Other well-defined object states
• Use advanced ERB and YAML features to define fixtures dynamically.</p>

<p>Testing Active Record Models</p>

<p>Active Record maps the application database to Ruby objects that manage attributes, relationships, queries, and lifecycle methods among other things.</p>

<p>• Test public methods, not private ones.
• Test interfaces, not implementations.
• Don’t test Active Record (or the rest of Rails, for that matter).
• You need to test some of the typical aspects of Active Record models:
	◦ Complex validations
	◦ Scopes
	◦ Callback targets and hooks
• Make assertions about the results and side effects of public instance methods.
• Make (selective) assertions an object’s behavior toward collaborators.</p>

<p>Testing Controllers</p>

<p>There’s been a faction of the Rails community that has become vocal about skipping controller testing completely. They usually argue that simulating more realistic user interactions eliminates the need for more focused controller tests which tend to be very repetitive and dull to write anyway. Even the core team has started a gradual move away from controller testing.</p>

<p>◦ Controller tests should include assertions for the visible side effects that controller actions produce including:
	◦ HTTP response code
	◦ Redirect location
	◦ System state changes (models created, updated, or destroyed)
	◦ Flash variables, session variables, and cookies set or changed
• You should write tests for complex or generated routes.
• Controllers should specifically not make assertions about any of the following:
	◦ Rendered templates
	◦ Instance variables passed to the view</p>
</div>


<div class='breaker'></div>

<h3>Details</h3>
<ul itemprop="itemReviewed" itemscope itemtype="http://schema.org/Book">
  <li><span itemprop=name>The Minitest Cookbook</span> by <span itemprop=author>Chris Kottom</span></li>

  
  

  <li>Published: <span itemprop=datePublished>2012</span></li>
  
</ul>

  <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="dominiclizarraga.github.io">
    <meta itemprop="url" content="http://localhost:4000">
  </div>
  <meta itemprop="author" content="dom lizarraga">
  <meta itemprop="url" content="http://localhost:4000/2022/01/05/minitest_cookbook.html">

</div>

<div class="mobile-only-button">
  <!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="domlizarrraga" data-color="#5F7FFF" data-emoji="🍕" data-font="Comic" data-text="Buy me a pizza" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script> -->
</div>

<script src="https://giscus.app/client.js"
        data-repo="dominiclizarraga/dominiclizarraga.github.io"
        data-repo-id="R_kgDOJ601Dg"
        data-category="General"
        data-category-id="DIC_kwDOJ601Ds4CliRX"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    </div>
  </div>
  <script>
    // 80s light switch click sound using Web Audio API
    function playClickSound() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = ctx.createOscillator();
        const gain = ctx.createGain();

        oscillator.connect(gain);
        gain.connect(ctx.destination);

        oscillator.frequency.setValueAtTime(1800, ctx.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.03);

        gain.gain.setValueAtTime(0.3, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);

        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.05);
      } catch (e) {}
    }

    function toggleTheme() {
      playClickSound();
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateLabel(next);
    }

    function updateLabel(theme) {
      const label = document.querySelector('.theme-icon');
      if (label) {
        label.textContent = theme === 'dark' ? 'light' : 'dark';
      }
    }

    // Set correct label on load
    document.addEventListener('DOMContentLoaded', function() {
      const theme = document.documentElement.getAttribute('data-theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      updateLabel(theme);
    });
  </script>
</body>
</html>
